add_subdirectory(andersen)
add_subdirectory(pmtest)

set(BUILD_SHARED_LIBS ON)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)
add_subdirectory(yaml-cpp)
set_property(GLOBAL PROPERTY yaml_cpp_lib_dir ${CMAKE_CURRENT_BINARY_DIR}/yaml-cpp)
set_property(GLOBAL PROPERTY yaml_cpp_include_dir ${CMAKE_CURRENT_BINARY_DIR}/yaml-cpp/include)

include(ProcessorCount)
ProcessorCount(NPROC)

set(PMDK_ROOT_DIR ${CMAKE_CURRENT_SOURCE_DIR}/pmdk)
set(PMDK_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/pmdk)
set(PMDK_INCLUDE_DIR ${PMDK_INSTALL_DIR}/include)
set(PMDK_LIB_DIR ${PMDK_INSTALL_DIR}/lib)
execute_process(COMMAND make -C ${PMDK_ROOT_DIR} -j${NPROC})
execute_process(COMMAND make -C ${PMDK_ROOT_DIR} -j${NPROC} install prefix=${PMDK_INSTALL_DIR})
set_property(GLOBAL PROPERTY pmdk_lib_dir ${PMDK_LIB_DIR})
set_property(GLOBAL PROPERTY pmdk_include_dir ${PMDK_INCLUDE_DIR})